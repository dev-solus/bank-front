<div class="sm:absolute sm:inset-0 flex flex-col flex-auto min-w-0 sm:overflow-hidden bg-card dark:bg-transparent">

    <!-- Header -->
    <div
        class="flex flex-col sm:flex-row flex-0 sm:items-center sm:justify-between p-6 sm:py-8 sm:px-10 border-b bg-card dark:bg-transparent">
        <div class="flex-1 min-w-0">
            <!-- Title -->
            <div class="mt-2 flex justify-between items-center">
                <h2 class="text-3xl md:text-4xl font-extrabold tracking-tight leading-7 sm:leading-10 ">
                    Operations
                </h2>

                <div class="flex gap-1">
                    <div class="flex gap-2">
                        <mat-form-field appearance="fill" class="w-72">
                            <mat-label>Filter</mat-label>
                            <input matInput (keyup.enter)="search()" placeholder="Utilisateur, CIN, email, compte" [formControl]="operationType" required>
                        </mat-form-field>

                        <mat-form-field appearance="fill" class="w-72">
                            <mat-label>Compte</mat-label>
                            <mat-select [formControl]="accountId" (selectionChange)="search()">
                                <mat-option *ngFor="let e of accounts()" [value]="e.id">{{e.accountNumber}} ({{e.balance}} MAD)</mat-option>
                            </mat-select>
                        </mat-form-field>


                            <button mat-raised-button (click)="reset()">
                                <mat-icon svgIcon="heroicons_outline:arrow-uturn-left"></mat-icon>
                            </button>
                    </div>

                    <button mat-flat-button [color]="'primary'" (click)="add()">
                        <mat-icon [svgIcon]="'heroicons_outline:plus'"></mat-icon>
                        <span class="ml-2 mr-1">Add</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <ng-container *ngIf="showMessage$ | async as e">
        <fuse-alert class="w-full my-5" [@shake]="true" [type]="e.code < 0 ? 'warn' : 'success'"
            [appearance]="'border'">
            <span fuseAlertTitle>Message</span>
            {{e.message}}
        </fuse-alert>
    </ng-container>

    <!-- Main -->
    <div class="flex flex-auto overflow-hidden">
        <!-- Balances list -->
        <div class="flex flex-col flex-auto sm:mb-18 overflow-hidden sm:overflow-y-auto ">
            <ng-container>
                <ng-container>
                    <div class="">
                        <!-- Header -->
                        <div class="grid grid-cols-1 md:grid-cols-10 z-10 sticky top-0 gap-4 py-4 px-6 md:px-8 shadow text-md font-semibold text-secondary bg-gray-50 dark:bg-black dark:bg-opacity-5 "
                            matSort matSortDisableClear>
                            <div >id</div>
                            <div class="col-span-3 flex gap-2 items-center">
                                <span>Compte Débité</span>
                                <mat-icon svgIcon="heroicons_outline:arrow-trending-down"></mat-icon>
                            </div>
                            <div class="col-span-3 flex gap-2 items-center">
                                <span>Compte Crédité</span>
                                <mat-icon svgIcon="heroicons_outline:arrow-trending-up"></mat-icon>
                            </div>
                            <div>Montant</div>
                            <div>Date</div>

                            <div>Action</div>
                        </div>
                        <!-- Rows -->

                        <ng-container *ngFor="let e of dataSource(); let i=index; trackBy: trackById">
                            <div class="grid grid-cols-1 md:grid-cols-10 items-center gap-4 py-3 px-6 md:px-8 border-b">

                                <div class="">{{e.id}}</div>
                                <div class="col-span-3">
                                    <span *ngIf="e.accountCredit.user as u" class="flex gap-2" >
                                        <span [ngClass]="{'border-b border-green-600': $any(e.accountCredit).border}">{{u.firstname}} {{u.lastname}}</span>
                                        <span class="underline cursor-pointer text-sm italic" (click)="operationType.setValue(u.cin);search()">(CIN: {{u.cin}}) - Compte {{e.accountCredit?.accountNumber}}</span>
                                    </span>
                                 </div>
                                <div class="col-span-3">
                                    <span *ngIf="e.accountDebit.user as u" class="flex gap-2" >
                                        <span [ngClass]="{'border-b border-green-600': $any(e.accountDebit).border}">{{u.firstname}} {{u.lastname}}</span>
                                        <span class="underline cursor-pointer text-sm italic" (click)="operationType.setValue(u.cin);search()">(CIN: {{u.cin}}) - Compte {{e.accountDebit?.accountNumber}}</span>
                                    </span>
                                </div>
                                <div class="">{{e.amount}}</div>
                                <div class="">{{e.date | date: "dd/MM/yyyy, HH:mm"}}</div>
                                <div class="flex gap-2">
                                    <button class="min-w-10 min-h-7 h-7 px-2 leading-6" mat-stroked-button
                                        matTooltip="Go to Edit form" (click)="edit(e)">
                                        <mat-icon class="icon-size-5" [svgIcon]="'heroicons_outline:pencil' ">
                                        </mat-icon>
                                    </button>
                                    <button class="min-w-10 min-h-7 h-7 px-2 leading-6" mat-stroked-button
                                        matTooltip="Delete this item" (click)="remove(e)">
                                        <mat-icon class="icon-size-5" [svgIcon]="'heroicons_outline:trash' ">
                                        </mat-icon>
                                    </button>
                                </div>
                            </div>
                        </ng-container>
                    </div>

                    <mat-paginator #paginator
                        class="sm:absolute sm:inset-x-0 sm:bottom-0 border-b sm:border-t sm:border-b-0 z-10 bg-gray-50 dark:bg-transparent"
                        [length]="totalRecords" [pageIndex]="0" [pageSize]="10" [pageSizeOptions]="[5, 10, 25, 100]"
                        [showFirstLastButtons]="true">
                    </mat-paginator>

                </ng-container>
            </ng-container>
        </div>
    </div>
</div>
